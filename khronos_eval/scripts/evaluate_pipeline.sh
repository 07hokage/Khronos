#!/bin/bash

# ========== Params ==========
experiment_dir="/home/marcus/code/khronos_ws/src/khronos/output/tmp"
evaluation_config=$(rospack find khronos_eval)/config/pipeline/office.yaml           # Which evaluation config to use.
force_recompute=true                                                                 # Force recomputation if output or results already exist.
only_evaluate_final_map=false                                                        # Only evaluate the final map.
# ========== What to run ==========
run_evaluation=true

# ========== Params can be supplied as arguments ==========
if [ -n "$1" ]; then
    experiment_dir=$1
fi
if [ -n "$2" ]; then
    evaluation_config=$2
fi
if [ -n "$3" ]; then
    force_recompute=$3
fi
if [ -n "$4" ]; then
    only_evaluate_final_map=$4
fi

# ========== Autogenerated arguments ==========
exec_dir=$(catkin_find --first-only --without-underlays --libexec khronos_eval)
if [[ $exec_dir == "" ]]; then
    echo "Could not find executable directory. Did you source the workspace?"
    exit 1
fi
src_dir=$(rospack find khronos_eval)
if [[ $src_dir == "" ]]; then
    echo "Could not find source directory. Did you source the workspace?"
    exit 1
fi

# ========== Functions ==========
function evaluate {
    if [ $run_evaluation == true ]; then
        echo "---------- Evaluation ----------"
        eval $exec_dir/exp_pipeline $evaluation_config $experiment_dir $force_recompute $run_evaluation $only_evaluate_final_map
    fi
}
# ========== Run Evaluation ==========
evaluate
